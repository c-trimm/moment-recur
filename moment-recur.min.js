!function(t,e){"object"==typeof exports?module.exports=e(require("moment")):"function"==typeof define&&define.amd?define("moment-recur",["moment"],e):t.moment=e(t.moment)}(this,function(t){var e;if(e="undefined"!=typeof module&&null!==module&&null!=module.exports,"undefined"==typeof t)throw Error("Can't find moment");var r=function(){function t(t,e){for(var r in t)if(t.hasOwnProperty(r)&&parseInt(r,10)<=0)throw Error("Intervals must be greater than zero");return{measure:e,units:t}}function e(t,e,n,s){var a=r(t,n,s);for(var o in e)if(e.hasOwnProperty(o)&&(o=parseInt(o,10),a%o===0))return!0;return!1}function r(t,e,r){var n=null;return"wholeMonths"==t?n=Math.abs(r.month()-e.month())+12*Math.abs(r.year()-e.year()):(n=r.isBefore(e)?e.diff(r,t,!0):r.diff(e,t,!0),"days"==t&&(n=parseInt(n))),n}return{create:t,match:e}}(),n=function(){function e(t,e,r){r.forEach(function(r){if(t>r||r>e)throw Error("Value should be in range "+t+" to "+e)})}function r(e,r){var n,s,a,o={};for(n in e)e.hasOwnProperty(n)&&(s=parseInt(n,10),isNaN(s)&&(s=n),a=t().set(r,s).get(r),o[a]=e[n]);return o}function n(t,n){var s=[];"daysOfWeek"===n&&(t=r(t,"days")),"monthsOfYear"===n&&(t=r(t,"months"));for(var a in t)hasOwnProperty.call(t,a)&&s.push(a);return e(o[n].low,o[n].high,s),{measure:n,units:t}}function s(t,e,r){var n=a[t],s=r[n]();if(e[s])return!0;if("date"===n&&s==r.add(1,"months").date(0).format("D")&&31>s)for(;31>=s;){if(e[s])return!0;s++}return!1}var a={daysOfMonth:"date",daysOfWeek:"day",weeksOfMonth:"monthWeek",weeksOfMonthByDay:"monthWeekByDay",weeksOfYear:"week",monthsOfYear:"month"},o={daysOfMonth:{low:1,high:31},daysOfWeek:{low:0,high:6},weeksOfMonth:{low:0,high:4},weeksOfMonthByDay:{low:0,high:4},weeksOfYear:{low:0,high:52},monthsOfYear:{low:0,high:11}};return{create:n,match:s}}(),s=function(){function e(){var t,e=l[this.measure];if(!(this instanceof d))throw Error("Private method trigger() was called directly or not called as instance of Recur!");if("undefined"==typeof this.units||null===this.units||!this.measure)return this;this.validateRule(e),"interval"===e&&(t=r.create(this.units,this.measure)),"calendar"===e&&(t=n.create(this.units,this.measure)),this.units=null,this.measure=null;for(var s=0;s<this.rules.length;s++)this.rules[s].measure===t.measure&&this.rules.splice(s,1);return this.rules.push(t),this}function s(t,e,r){var n,s,a=[];if(!(this instanceof d))throw Error("Private method trigger() was called directly or not called as instance of Recur!");if(!this.start&&!this.from)throw Error("Cannot get occurances without start or from date.");if("all"===r&&!this.end)throw Error("Cannot get all occurances without an end date.");if(this.end&&this.start>this.end)throw Error("Start date cannot be later than end date.");if("all"!==r&&!(t>0))return a;for(n=(this.from||this.start).clone(),"all"===r&&this.matches(n,!1)&&(s=e?n.format(e):n.clone(),a.push(s));a.length<(null===t?a.length+1:t)&&("next"===r||"all"===r?n.add(1,"day"):n.subtract(1,"day"),this.matches(n,"all"===r?!1:!0)&&(s=e?n.format(e):n.clone(),a.push(s)),!("all"===r&&n>=this.end)););return a}function a(t,e,r){return t&&r.isBefore(t)?!1:e&&r.isAfter(e)?!1:!0}function o(t){var e={};if("[object Array]"==Object.prototype.toString.call(t))t.forEach(function(t){e[t]=!0});else if(t===Object(t))e=t;else{if("[object Number]"!=Object.prototype.toString.call(t)&&"[object String]"!=Object.prototype.toString.call(t))throw Error("Provide an array, object, string or number when passing units!");e[t]=!0}return e}function i(e,r){for(var n=0,s=e.length;s>n;n++)if(t(e[n]).isSame(r))return!0;return!1}function h(t){switch(t){case"day":return"days";case"week":return"weeks";case"month":return"months";case"wholeMonth":return"wholeMonths";case"year":return"years";case"dayOfWeek":return"daysOfWeek";case"dayOfMonth":return"daysOfMonth";case"weekOfMonth":return"weeksOfMonth";case"weekOfMonthByDay":return"weeksOfMonthByDay";case"weekOfYear":return"weeksOfYear";case"monthOfYear":return"monthsOfYear";default:return t}}function u(t,e,s){var a,o,i,h;for(a=0,o=t.length;o>a;a++)if(i=t[a],h=l[i.measure],"interval"===h){if(!r.match(i.measure,i.units,s,e))return!1}else{if("calendar"!==h)return!1;if(!n.match(i.measure,i.units,e))return!1}return!0}function f(t){return function(e){return this.every.call(this,e,t),this}}var l={days:"interval",weeks:"interval",months:"interval",wholeMonths:"interval",years:"interval",daysOfWeek:"calendar",daysOfMonth:"calendar",weeksOfMonth:"calendar",weeksOfMonthByDay:"calendar",weeksOfYear:"calendar",monthsOfYear:"calendar"},c={days:"day",weeks:"week",months:"month",wholeMonths:"wholeMonth",years:"year",daysOfWeek:"dayOfWeek",daysOfMonth:"dayOfMonth",weeksOfMonth:"weekOfMonth",weeksOfMonthByDay:"weekOfMonthByDay",weeksOfYear:"weekOfYear",monthsOfYear:"monthOfYear"},d=function(e){e.start&&(this.start=t(e.start).dateOnly()),e.end&&(this.end=t(e.end).dateOnly()),this.rules=e.rules||[];var r=e.exceptions||[];this.exceptions=[];for(var n=0;n<r.length;n++)this.except(r[n]);return this.units=null,this.measure=null,this.from=null,this};d.prototype.startDate=function(e){return null===e?(this.start=null,this):e?(this.start=t(e).dateOnly(),this):this.start},d.prototype.endDate=function(e){return null===e?(this.end=null,this):e?(this.end=t(e).dateOnly(),this):this.end},d.prototype.fromDate=function(e){return null===e?(this.from=null,this):e?(this.from=t(e).dateOnly(),this):this.from},d.prototype.save=function(){var e={};this.start&&t(this.start).isValid()&&(e.start=this.start.format("L")),this.end&&t(this.end).isValid()&&(e.end=this.end.format("L")),e.exceptions=[];for(var r=0,n=this.exceptions.length;n>r;r++)e.exceptions.push(this.exceptions[r].format("L"));return e.rules=this.rules,e},d.prototype.repeats=function(){return this.rules.length>0?!0:!1},d.prototype.every=function(t,r){return"undefined"!=typeof t&&null!==t&&(this.units=o(t)),"undefined"!=typeof r&&null!==r&&(this.measure=h(r)),e.call(this)},d.prototype.except=function(e){return e=t(e).dateOnly(),this.exceptions.push(e),this},d.prototype.forget=function(e){var r,n,s=t(e);if(s.isValid()){for(s=s.dateOnly(),r=0,n=this.exceptions.length;n>r;r++)if(s.isSame(this.exceptions[r]))return this.exceptions.splice(r,1),this;return this}for(r=0,n=this.rules.length;n>r;r++)this.rules[r].measure===h(e)&&this.rules.splice(r,1)},d.prototype.hasRule=function(t){var e,r;for(e=0,r=this.rules.length;r>e;e++)if(this.rules[e].measure===h(t))return!0;return!1},d.prototype.validateRule=function(t){if("calendar"!==t&&"interval"!==t)throw Error("Invalid measure provided: "+this.measure);if("interval"===t&&!this.start)throw Error("Must have a start date set to set an interval!");if("weeksOfMonthByDay"===this.measure&&!this.hasRule("daysOfWeek"))throw Error("weeksOfMonthByDay must be combined with daysOfWeek");if(!("wholeMonths"!==this.measure||this.hasRule("daysOfWeek")&&this.hasRule("weeksOfMonthByDay")))throw Error("wholeMonths must be combined with weeksOfMonthByDay and daysOfWeek")},d.prototype.matches=function(e,r){var n=t(e).dateOnly();if(!n.isValid())throw Error("Invalid date supplied to match method: "+e);return r||a(this.start,this.end,n)?i(this.exceptions,n)?!1:u(this.rules,n,this.start)?!0:!1:!1},d.prototype.next=function(t,e){return s.call(this,t,e,"next")},d.prototype.previous=function(t,e){return s.call(this,t,e,"previous")},d.prototype.all=function(t){return s.call(this,null,t,"all")};for(var y in c)l.hasOwnProperty(y)&&(d.prototype[y]=d.prototype[c[y]]=f(y));return d}();return t.recur=function(e,r){return new s(e!==Object(e)||t.isMoment(e)?{start:e,end:r}:e)},t.fn.recur=function(e,r){return e!==Object(e)||t.isMoment(e)?(r||(r=e,e=void 0),e||(e=this),new s({start:e,end:r,moment:this})):("undefined"==typeof e.start&&(e.start=this),new s(e))},t.fn.monthWeek=function(){var t=this.clone().startOf("month").startOf("week"),e=this.clone().startOf("week");return e.diff(t,"weeks")},t.fn.monthWeekByDay=function(t){var e,r,n,s;return e=this.clone(),r=this.clone().startOf("month").startOf("week"),n=this.clone().startOf("week"),s=n.diff(r,"weeks"),e.subtract(s,"weeks").month()===this.clone().month()?s:s-1},t.fn.dateOnly=function(){return this.tz&&"function"==typeof t.tz?t.tz(this.format("YYYY-MM-DD"),"UTC"):this.hours(0).minutes(0).seconds(0).milliseconds(0).add(this.utcOffset(),"minute").utcOffset(0)},t});